#!/usr/bin/env python
import sys, os
from socket import gethostname

# Set the current working directory to the directory where this script is located
os.chdir(os.path.abspath(os.path.dirname(sys.argv[0])))

#### Set the name of the application here and moose directory relative to the application
app_name = 'falcon'
MOOSE_DIR = '../moose'
#### See if MOOSE_DIR is already in the environment instead
if os.environ.has_key("MOOSE_DIR"):
  MOOSE_DIR = os.environ['MOOSE_DIR']


# Import the TestHarness and Helper functions from the MOOSE toolkit
sys.path.append(MOOSE_DIR + '/tests')
import tools

host_name = gethostname()
if host_name == 'service0' or host_name == 'service1':
  print 'Testing not supported on Icestorm head node'
  sys.exit(0)

  
# Determine the application name based on the libMesh naming scheme
# Assume the application is in the current working directory
method = ''
if os.environ.has_key('METHOD'):
  method = os.environ['METHOD']
else:
  method = 'opt'
executable = os.getcwd() + '/' + app_name + '-' + method

# create an instance of the test harness passing in the main arg vector
# and the name of the application executable
test_harness = tools.TestHarness(sys.argv, executable)
results, results_table, test_counter, time = test_harness.run_tests()
  
# Was it completely successful?
print "\n" + '-'*70 + "\nRan " + str(test_counter) + " tests in " + time + "s\n\nOK"
if results:
  print "\n" + results + results_table + "\n" + '-'*70 + "\nRan " + str(test_counter) + " tests in " + time + "s\n\nOK"
  sys.exit(1)

sys.exit(0)
